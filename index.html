<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>POTWIERDZENIE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Twoja biblioteka -->
  <link rel="stylesheet" href="https://okeciepark-dotcom.github.io/library/style.css">
  <script defer src="https://okeciepark-dotcom.github.io/library/config.js"></script>

  <style>
    .alert {display:none; margin-top:16px; padding:12px; border-radius:10px; border:1px solid #ddd}
    .alert--ok {background:#e8f5e9}
    .alert--err {background:#ffebee}
    button:disabled { opacity:.6; cursor:default; }
    header {padding: 6px !important;}
  </style>
</head>
<body>

  <!-- Logo -->
  <header>
    <img id="op-logo" class="header__logo" alt="Logo" data-hide-until-ready>
  </header>

  <main>
    <div class="form-card">
      <h1>POTWIERDZENIE</h1>

      <p>
        (v4) Potwierdzasz, że lista kontaktów firmy
        <strong id="firma">—</strong>
        dla obiektu
        <strong id="obiekt">—</strong>
        jest aktualna.
      </p>

      <p style="margin-top:10px">
        Osoba pierwszego kontaktu:
        <strong id="osoba">—</strong><br>
        e-mail:
        <strong id="email"><a id="emailLink" href="#">—</a></strong>
      </p>

      <!-- Ukryty iframe do submitu bez przeładowania -->
      <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

      <!-- FORMULARZ POST do Google Forms (UWAGA: podmień action na swój formularz jeśli inny) -->
      <form id="confForm"
            class="actions"
            action="https://docs.google.com/forms/d/15flx1SBwjdQnomWlGlsC0K-Tx1cgs59ksvwd49aI5-A/formResponse"
            method="POST"
            target="hidden_iframe">

        <!-- Ukryte pola uzupełniane z URL -->
        <input type="hidden" name="entry.1713595308" id="idAkt">    <!-- ID_Aktualizacja -->
        <input type="hidden" name="entry.1276633088" id="inpFirma"> <!-- Firma -->
        <input type="hidden" name="entry.1492857322" id="inpObiekt"><!-- Obiekt -->
        <input type="hidden" name="entry.1906223239" id="inpOsoba"> <!-- Osoba kontaktowa -->
        <input type="hidden" name="entry.510307459"  id="inpEmail"> <!-- Adres e-mail -->

        <!-- Pola techniczne (jak w działającej wersji) -->
        <input type="hidden" name="fvv" value="1">
        <input type="hidden" name="partialResponse" value="">
        <input type="hidden" name="pageHistory" value="0">

        <button type="submit" id="btnConfirm">Potwierdź</button>
      </form>

      <!-- Komunikaty -->
      <div id="alert-ok"  class="alert alert--ok"  role="status" aria-live="polite">Dziękujemy! Możesz zamknąć to okno</div>
      <div id="alert-err" class="alert alert--err" role="alert">Nie udało się wysłać. Odśwież i spróbuj ponownie.</div>
    </div>
  </main>

  <!-- Stopka -->
  <footer data-hide-until-ready>
    <p>© <span id="op-org">Okęcie Park</span></p>
    <p>Kontakt: <a id="op-mail" href="#">email</a></p>
    <p><a id="op-privacy" href="#" target="_blank" rel="noopener">Polityka prywatności</a></p>
  </footer>

  <script>
    // 1) Logo i stopka z biblioteki
    document.addEventListener("DOMContentLoaded", () => {
      const cfg = window.OP_CONFIG || {};
      const logo = document.getElementById("op-logo");
      if (logo && cfg.logoUrl) logo.src = cfg.logoUrl;
      const org  = document.getElementById("op-org");
      const mail = document.getElementById("op-mail");
      const priv = document.getElementById("op-privacy");
      if (org && cfg.orgName) org.textContent = cfg.orgName;
      if (mail && cfg.orgEmail) { mail.textContent = cfg.orgEmail; mail.href = `mailto:${cfg.orgEmail}`; }
      if (priv && cfg.privacyUrl) priv.href = cfg.privacyUrl;
      document.documentElement.classList.add("ready");
    });

    // 2) Prefill z parametrów URL → widok + hidden inputs
    const MAP = {
      "entry.1713595308": ["idAkt"],     // ID_Aktualizacja
      "entry.1276633088": ["firma","inpFirma"], // Firma
      "entry.1492857322": ["obiekt","inpObiekt"], // Obiekt
      "entry.1906223239": ["osoba","inpOsoba"],   // Osoba kontaktowa
      "entry.510307459" : ["email","inpEmail"]    // Adres e-mail
    };

    function getParam(name){ return new URLSearchParams(location.search).get(name) || ""; }

    (function prefill(){
      for (const entry of Object.keys(MAP)) {
        const val = getParam(entry);
        if (!val) continue;

        for (const id of MAP[entry]) {
          const el = document.getElementById(id);
          if (!el) continue;

          if (id === "email") {
            const a = document.getElementById("emailLink");
            if (a) { a.textContent = val; a.href = `mailto:${val}`; }
            else   { el.textContent = val; }
          } else if (el.tagName === "INPUT") {
            el.value = val;
          } else {
            el.textContent = val;
          }
        }
      }
    })();

    // 3) Obsługa sukces/błąd jak w pierwotnej wersji (iframe load = sukces)
    (function attachNoReloadSubmit(){
      const form   = document.getElementById('confForm');
      const btn    = document.getElementById('btnConfirm');
      const okBox  = document.getElementById('alert-ok');
      const errBox = document.getElementById('alert-err');
      const iframe = document.getElementById('hidden_iframe');

      let submitted = false;

      form.addEventListener('submit', () => {
        submitted = true;
        btn.disabled = true;
        okBox.style.display  = 'none';
        errBox.style.display = 'none';
        // jeśli Google Forms zredirectuje w iframe, „load” się wywoła
      });

      iframe.addEventListener('load', () => {
        if (!submitted) return;
        submitted = false;
        okBox.style.display  = 'block';
        errBox.style.display = 'none';
        // (opcjonalnie) odblokuj przycisk jeśli chcesz pozwolić na ponowną wysyłkę:
        // btn.disabled = false;
      });

      // Awaryjnie pokaż błąd, gdyby Google nie załadował odpowiedzi do iframe
      form.addEventListener('submit', () => {
        setTimeout(() => {
          if (okBox.style.display !== 'block') {
            errBox.style.display = 'block';
          }
        }, 8000);
      });
    })();
  </script>
</body>
</html>




